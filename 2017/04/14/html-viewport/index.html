<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="theme-color" content="#1b7aca">
  <link rel="icon" href="/icon.jpg">
  <meta name="application-name" content="青菜不是葵花"/>
  <meta name="msapplication-TileColor" content="#1b7aca"/>
  <meta name="msapplication-square70x70logo" content="/icon.jpg" />
  <meta name="msapplication-square150x150logo" content="/icon.jpg" />
  <meta name="msapplication-wide310x150logo" content="/icon.jpg" />
  <meta name="msapplication-square310x310logo" content="/icon.jpg" />
  <meta name="msapplication-notification" content="frequency=30; polling-uri=/atom.xml" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="/icon.jpg">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-startup-image" href="/icon.jpg">

  
  <title>关于viewport的一些思考 | 青菜不是葵花</title>
  <meta name="author" content="青菜">
  
  <meta name="description" content="主攻前端方向，偶尔来点杂文">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="关于viewport的一些思考"/>
  <meta property="og:site_name" content="青菜不是葵花"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="青菜不是葵花" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
    <link href="/css/animate.css" rel="stylesheet">
  
  
    <script src="/js/jquery-2.0.3.min.js"></script>
  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script>
    if (window.location.href.indexOf("yoursite.com")<0) {      location.href = location.href.replace(location.host, "yoursite.com");    }
  </script>

</head>


<body>
<!--[if lt IE9]>
<script>
alert("Please Update Your IE \n请升级您的IE浏览器");
</script>
< ![endif]-->
  <header id="header" class="header header--fixed hide-from-print animated slideInDown"><div class="alignleft backtohome">
  <a href="/">
    <img id="icon-photo-small" class="personal-photo  animated rotateIn" src="/icon.jpg" alt="青菜">
  </a>
  <h1 id="title-mini" class=""><a href="/">青菜不是葵花</a></h1>
</div>
<a target="_blank" id="mini-toggle" class="more icon alignright"></a>
<nav id="main-nav" class="alignright animated slideInRight">

    
    
      <a target="_blank" class="icon twitter" href="http://twitter.com/1ittlecup"></a>
    
    
    
      <a target="_blank" class="icon googleplus" href="http://plus.google.com/+RuoxinHe"></a> 
    
    
    
    
    
    
      <a target="_blank" class="icon zhihu" href="http://zhihu.com/people/1ittlecup"></a>
    
    
    
  <div class="clearfix"></div>
</nav>

</header>
  <aside id="sidebar" class="alignleft animated slideInLeft"><div class="personal-info">
  <figure>
    
    <div  class="backtohome">
      <a href="/">
        <img id="icon-photo-normal" class="personal-photo animated rotateIn" src="/icon.jpg" alt="青菜">
      </a>
    </div>
    
    <figcaption>
      <h3 class=>青菜</h3>
      <p>绽放吧！</p>
    </figcaption>
  </figure>
  <section class="social">
    
    
      <a target="_blank" class="icon twitter depth" href="http://twitter.com/1ittlecup"></a>
    
    
    
      <a target="_blank" class="icon googleplus depth" href="http://plus.google.com/+RuoxinHe"></a> 
    
    
    
    
    
    
      <a target="_blank" class="icon zhihu depth" href="http://zhihu.com/people/1ittlecup"></a>
    
    
    
  </section>
</div>
<div class="theme-info">
  <a target="_blank" href="https://github.com/heruoxin/hexo-persona-color" class="html5"> Persona Color Theme</a> 
  &copy; - 2018 青菜
  
</div>
</aside>
  <div id="content" class="inner">
    <p id="header-fix"></p>
    <div id="main-col" class="alignright"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-04-14T10:40:03.000Z"><a href="#">2017-04-14</a></time>
      
      
  
    <h1 class="depth title">关于viewport的一些思考</h1>
  

    </header>
    <div class="entry depth">
      
        <p>在写html时我们经常会看到头部有一列的meta标签，因此最近总结了一些比较常用的http-equiv属性和name属性，在前一篇<a href="/2017/04/13/html-meta/">文章</a>中可以查阅到。这其中最有意思的就是viewport了，这个属性决定了用户访问你的网站时的第一体验。下面我们按照桌面浏览器以及移动浏览器两个板块来学习下viewport。</p>
<h2 id="桌面浏览器"><a href="#桌面浏览器" class="headerlink" title="桌面浏览器"></a>桌面浏览器</h2><h3 id="设备像素和CSS像素"><a href="#设备像素和CSS像素" class="headerlink" title="设备像素和CSS像素"></a>设备像素和CSS像素</h3><p>设备像素是固定的，可以从<code>screen.width/height</code>读出，而CSS像素的可见大小是可以变化的。如果我们给一个元素设置了<code>width:512px</code>的属性，且显示器是1024px宽，当我们将页面放大一倍时，此时该元素将占满整个宽度，每个像素的宽度都被拉伸到原来的一被大，也就是每个像素占着2个实际像素的空间，因此占满整个屏幕。在缩放比例100%的情况下一个CSS像素完全等于一个设备像素。</p>
<h3 id="屏幕尺寸"><a href="#屏幕尺寸" class="headerlink" title="屏幕尺寸"></a>屏幕尺寸</h3><p>意义：用户屏幕的整体大小。<br>度量：设备像素。<br>获取：screen.width/height。</p>
<h3 id="窗口尺寸"><a href="#窗口尺寸" class="headerlink" title="窗口尺寸"></a>窗口尺寸</h3><p>意义：浏览器窗口的整体大小，包括滚动条。对窗口进行放大或缩小时值会变。<br>度量：CSS像素。<br>获取：window.innerWidth/Height。</p>
<h3 id="滚动距离"><a href="#滚动距离" class="headerlink" title="滚动距离"></a>滚动距离</h3><p>意义：页面的滚动距离，具体指滚动条距顶部的距离。<br>度量单位：CSS像素。<br>滚动距离的度量方式为css像素，可以通过window.pageXOffset/pageYOffset来获取。</p>
<h3 id="viewport"><a href="#viewport" class="headerlink" title="viewport"></a>viewport</h3><p>我们都知道块级子元素的宽度默认为块级父元素的100%，body的宽度默认来自于html的宽度，那么html的宽度来自哪呢？其实html是在一个叫viewport的假想机制下进行渲染的,在桌面浏览器中，这个viewport的宽度就等于浏览器窗口的宽度（不包括滚动条）。<br>既然html的宽度来自于viewport的宽度，而documentElement指向html元素，那么我们可以通过<code>document.documentElement.clientWidth</code>来得到viewport的宽度。但这里有一个特殊的规则，即使设定了html的宽度，clientWidth还是指向viewport的宽度。<br>若想真正获取html的宽度，我们可以通过另一个方法<code>document.documentElement.offfsetWidth</code>,该属性始终都指向html的宽度值。</p>
<h3 id="事件中的坐标"><a href="#事件中的坐标" class="headerlink" title="事件中的坐标"></a>事件中的坐标</h3><p><code>pageX\Y</code>提供了相对于html元素的以css像素度量的坐标。<br><code>clientX/Y</code>提供了相对于viewport的以css像素度量的坐标<br><code>screenX/Y</code>提供了相对于屏幕的以设备像素进行度量的坐标。</p>
<h3 id="媒体查询"><a href="#媒体查询" class="headerlink" title="媒体查询"></a>媒体查询</h3><p>媒体查询使用的宽高是viewport的宽高而不是设备的宽高。因为我们感兴趣的是基于css像素的页面，而不是基于设备像素的页面。</p>
<hr>
<h2 id="移动浏览器"><a href="#移动浏览器" class="headerlink" title="移动浏览器"></a>移动浏览器</h2><h3 id="两个viewport"><a href="#两个viewport" class="headerlink" title="两个viewport"></a>两个viewport</h3><p>如果我们继续按照在桌面浏览器中渲染页面的方式来设计移动浏览器，那么我们的站点将陷入一个无比尴尬之地，要么为移动端单独设计网页，要么页面在移动端的显示非常拥挤。这时浏览器厂商尝试了一种比较有利的做法，他们把浏览器中的一个viewport变成两个viewport,一个是layout viewport,另一个则是visual viewport。先来看这两个概念的定义。</p>
<blockquote>
<p>layout viewport的宽度和高度等于在最大限度缩小的模式下屏幕上所能显示的任何内容的尺寸。<br>visual viewport是页面当前显示在屏幕上的部分。用户可以通过滚动来改变他所看到的页面的部分，或者通过缩放来改变visual viewport的大小。</p>
</blockquote>
<img src="/2017/04/14/html-viewport/viewport.PNG" alt="viewport.PNG" title="">
<p>我们可以把layout viewport想象成一个后花园，后花园的大小不会变（不太严谨，高度在设备旋转后会微变）<br>，且带有一个可移动的门，我们从这个门里所看到的景物就是visual viewport, 当我们走进（放大）这个门时，visual viewport就会变大，当我们远离（缩小）时，visual viewport就会变小。此外我们还可以通过移动这扇门来观察到后花园的每个角落。</p>
<p>此时，html不再像桌面浏览器中那样继承于viewport,移动浏览器厂商让html的宽度基于layout viewport这个固定大小的后花园，而设备屏幕则相当于我们的这个移动门，屏幕里的内容就是我们的visual viewport。显然，内容的尺寸会发生变化，visual viewport的大小也会随之变化。</p>
<h3 id="度量layout-viewport"><a href="#度量layout-viewport" class="headerlink" title="度量layout viewport"></a>度量layout viewport</h3><p><code>document.documentElement.clientWidth/Height</code></p>
<h3 id="度量visual-viewport"><a href="#度量visual-viewport" class="headerlink" title="度量visual viewport"></a>度量visual viewport</h3><p><code>window.innerWidth/Height</code></p>
<h3 id="屏幕"><a href="#屏幕" class="headerlink" title="屏幕"></a>屏幕</h3><p>依然是 <code>screen.width/height</code></p>
<h3 id="缩放比例"><a href="#缩放比例" class="headerlink" title="缩放比例"></a>缩放比例</h3><p>可以通过以screen.width除以window.innerWidth来获取它的值。</p>
<h3 id="滚动距离-1"><a href="#滚动距离-1" class="headerlink" title="滚动距离"></a>滚动距离</h3><p><code>window.pageX/YOffset</code> 表示visual viewport相对于layout viewport的位置。</p>
<h3 id="html元素"><a href="#html元素" class="headerlink" title="html元素"></a>html元素</h3><p><code>document.documentElement.offsetWidth/Height</code>可以获取html的宽高。</p>
<h3 id="媒体查询-1"><a href="#媒体查询-1" class="headerlink" title="媒体查询"></a>媒体查询</h3><p>width/height使用layout viewport做为参照物，并且以CSS像素进行度量，device-width/height使用设备屏幕，并且以设备像素进行度量。</p>
<h3 id="事件坐标"><a href="#事件坐标" class="headerlink" title="事件坐标"></a>事件坐标</h3><p>同桌面浏览器工作方式</p>
<h3 id="viewport-meta标签"><a href="#viewport-meta标签" class="headerlink" title="viewport meta标签"></a>viewport meta标签</h3><p>意义：设置layout viewport的宽度。<br>度量单位：CSS像素。<br>铺垫辣么长，终于到了我们的重点了。假如我们创建一个简单的页面，且没有设置元素宽度，那么页面就会以拉伸的方式填满layout viewport，继而再在整个屏幕上显示，此时页面的内容将会非常小。因为大多数的layout viewport被设置为980px。viewport标签则提供了我们可以修改其宽度的接口。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=320"</span>&gt;</span></div></pre></td></tr></table></figure><br>通过将viewport（实为layout viewport）设置为320px,我们的html在移动端则基于320px的框架去布局，这样既可得到更人性化的结果。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=320, intial-scale=1"</span>&gt;</span></div></pre></td></tr></table></figure><br>intial-scale则表示页面首次被显示是可视区域的缩放级别，一般开始时都不会是1，其公式为：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">当前缩放值 = ideal viewport宽度  / visual viewport宽度</div></pre></td></tr></table></figure><br>这里的ideal viewport宽度为移动设备的屏幕宽度（以CSS像素定义），所有iphone的屏宽都为320px。因此<code>initial-scale=1</code>与<code>width=320</code>有一样的效果，但因为这两种写法在不同场景各有瑕疵，因此一般都同时使用，若值不同则采取较大方式显示。<br>总的来说，viewport是针对移动端设备为了对桌面站点更友好而设计的一种技巧性api，但不同的浏览器还是有着大大小小的差异，使用中还得根据需求采取不同的方式。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/HTML/">HTML</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



</div></div>
    <div class="clearfix"></div>
  </div>

  <footer id="footer" class="inner"></footer>
  <script src="/js/headroom.min.and.gallery.js"></script>
<script>
$("#mini-toggle").click(function () {
    $( "#main-nav" ).css("display","inline");
    setTimeout(function(){
        $( "#main-nav" ).removeClass("slideInRight").addClass("slideOutRight");
    }, 3000);
    setTimeout(function(){
        $( "#main-nav" ).css("display","");
        $( "#main-nav" ).removeClass("slideOutRight").addClass("slideInRight");
    }, 3555);
});
</script>

<script>
$("#header").headroom({
  "tolerance": 0,
  "offset": 200,
  "classes": {
    "initial": "",
    "pinned": "slideInDown",
    "unpinned": "slideOutUp"
  }
});
$("#header").headroom("destroy");
console.log("这网站没彩蛋，不用找了……")
</script>

<script>
$("a").click(function () {
    $( "#icon-photo-small"  ).removeClass( "rotateIn" ).addClass( "rotateOut" );
    $( "#icon-photo-normal" ).removeClass( "rotateIn" ).addClass( "rotateOut" );
    setTimeout(function(){
        $( "#icon-photo-small"  ).removeClass( "rotateOut" ).addClass( "rotateIn" );
        $( "#icon-photo-normal" ).removeClass( "rotateOut" ).addClass( "rotateIn" );
    }, 900);
});
</script>


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-46393541-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<!--[if lt IE 9]><script src="/js/excanvas.js"></script><![endif]-->
<script src="/js/jquery.tagcanvas.min.js"></script>
 <script type="text/javascript">
 $(document).ready(function() {
   if( ! $('#myCanvas').tagcanvas({
     textColour : '#6d6d6d',
     outlineThickness : 1,
     textHeight: 20,
     maxSpeed : 0.04,
     depth : 0.75
   })) {
     // TagCanvas failed to load
     $('#myCanvasContainer').hide();
   }
   // your other jQuery stuff here...
 });
 </script>


<script src="/js/pangu.js"></script>
<script>pangu.page_spacing();</script>



<script src="/js/jquery.imagesloaded.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
</html>
