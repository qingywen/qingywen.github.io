<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="theme-color" content="#1b7aca">
  <link rel="icon" href="/icon.jpg">
  <meta name="application-name" content="青菜不是葵花"/>
  <meta name="msapplication-TileColor" content="#1b7aca"/>
  <meta name="msapplication-square70x70logo" content="/icon.jpg" />
  <meta name="msapplication-square150x150logo" content="/icon.jpg" />
  <meta name="msapplication-wide310x150logo" content="/icon.jpg" />
  <meta name="msapplication-square310x310logo" content="/icon.jpg" />
  <meta name="msapplication-notification" content="frequency=30; polling-uri=/atom.xml" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="/icon.jpg">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-startup-image" href="/icon.jpg">

  
  <title>Page 2 | 青菜不是葵花</title>
  <meta name="author" content="青菜">
  
  <meta name="description" content="主攻前端方向，偶尔来点杂文">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="青菜不是葵花"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="青菜不是葵花" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
    <link href="/css/animate.css" rel="stylesheet">
  
  
    <script src="/js/jquery-2.0.3.min.js"></script>
  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script>
    if (window.location.href.indexOf("yoursite.com")<0) {      location.href = location.href.replace(location.host, "yoursite.com");    }
  </script>

</head>


<body>
<!--[if lt IE9]>
<script>
alert("Please Update Your IE \n请升级您的IE浏览器");
</script>
< ![endif]-->
  <header id="header" class="header header--fixed hide-from-print animated slideInDown"><div class="alignleft backtohome">
  <a href="/">
    <img id="icon-photo-small" class="personal-photo  animated rotateIn" src="/icon.jpg" alt="青菜">
  </a>
  <h1 id="title-mini" class=""><a href="/">青菜不是葵花</a></h1>
</div>
<a target="_blank" id="mini-toggle" class="more icon alignright"></a>
<nav id="main-nav" class="alignright animated slideInRight">

    
    
      <a target="_blank" class="icon twitter" href="http://twitter.com/1ittlecup"></a>
    
    
    
      <a target="_blank" class="icon googleplus" href="http://plus.google.com/+RuoxinHe"></a> 
    
    
    
    
    
    
      <a target="_blank" class="icon zhihu" href="http://zhihu.com/people/1ittlecup"></a>
    
    
    
  <div class="clearfix"></div>
</nav>

</header>
  <aside id="sidebar" class="alignleft animated slideInLeft"><div class="personal-info">
  <figure>
    
    <div  class="backtohome">
      <a href="/">
        <img id="icon-photo-normal" class="personal-photo animated rotateIn" src="/icon.jpg" alt="青菜">
      </a>
    </div>
    
    <figcaption>
      <h3 class=>青菜</h3>
      <p>绽放吧！</p>
    </figcaption>
  </figure>
  <section class="social">
    
    
      <a target="_blank" class="icon twitter depth" href="http://twitter.com/1ittlecup"></a>
    
    
    
      <a target="_blank" class="icon googleplus depth" href="http://plus.google.com/+RuoxinHe"></a> 
    
    
    
    
    
    
      <a target="_blank" class="icon zhihu depth" href="http://zhihu.com/people/1ittlecup"></a>
    
    
    
  </section>
</div>
<div class="theme-info">
  <a target="_blank" href="https://github.com/heruoxin/hexo-persona-color" class="html5"> Persona Color Theme</a> 
  &copy; - 2018 青菜
  
</div>
</aside>
  <div id="content" class="inner">
    <p id="header-fix"></p>
    <div id="main-col" class="alignright"><div id="wrapper">
  <div class="archive titlelist">
    <article class="post">
      <div class="post-content animated fadeIn">
        <header>
            
              <div class="icon depth"><a href="/2017/07/18/css-height/"> </a></div>
              <h2 class="depth title" ><a class="animated" href="/2017/07/18/css-height/">CSS中的高度系列</a></h2>
            
            <time class="time title depth" datetime="2017-07-18T11:18:07.000Z">2017-07-18</time>
          </header>
      </div>
    </article>
  </div>

  <div class="archive titlelist">
    <article class="post">
      <div class="post-content animated fadeIn">
        <header>
            
              <div class="icon depth"><a href="/2017/07/17/express-greeni/"> </a></div>
              <h2 class="depth title" ><a class="animated" href="/2017/07/17/express-greeni/">Web应用初体验——登录登出验证系统</a></h2>
            
            <time class="time title depth" datetime="2017-07-17T15:43:14.000Z">2017-07-17</time>
          </header>
      </div>
    </article>
  </div>

  <div class="archive titlelist">
    <article class="post">
      <div class="post-content animated fadeIn">
        <header>
            
              <div class="icon depth"><a href="/2017/07/12/nodejs-token/"> </a></div>
              <h2 class="depth title" ><a class="animated" href="/2017/07/12/nodejs-token/">浅谈令牌原理及漏洞分析</a></h2>
            
            <time class="time title depth" datetime="2017-07-11T18:59:14.000Z">2017-07-12</time>
          </header>
      </div>
    </article>
  </div>

  <div class="archive titlelist">
    <article class="post">
      <div class="post-content animated fadeIn">
        <header>
            
              <div class="icon depth"><a href="/2017/06/20/mysql-setup/"> </a></div>
              <h2 class="depth title" ><a class="animated" href="/2017/06/20/mysql-setup/">mysql-setup</a></h2>
            
            <time class="time title depth" datetime="2017-06-19T19:51:33.000Z">2017-06-20</time>
          </header>
      </div>
    </article>
  </div>

  <div class="archive titlelist">
    <article class="post">
      <div class="post-content animated fadeIn">
        <header>
            
              <div class="icon depth"><a href="/2017/06/06/js-pro-event/"> </a></div>
              <h2 class="depth title" ><a class="animated" href="/2017/06/06/js-pro-event/">js-pro-event</a></h2>
            
            <time class="time title depth" datetime="2017-06-05T16:48:29.000Z">2017-06-06</time>
          </header>
      </div>
    </article>
  </div>

  <div class="archive titlelist">
    <article class="post">
      <div class="post-content animated fadeIn">
        <header>
            
              <div class="icon depth"><a href="/2017/05/17/js-pro-ecma/"> </a></div>
              <h2 class="depth title" ><a class="animated" href="/2017/05/17/js-pro-ecma/">js-pro-ecma</a></h2>
            
            <time class="time title depth" datetime="2017-05-17T09:44:30.000Z">2017-05-17</time>
          </header>
      </div>
    </article>
  </div>

  <div class="archive titlelist">
    <article class="post">
      <div class="post-content animated fadeIn">
        <header>
            
              <div class="icon depth"><a href="/2017/05/17/js-pro-async/"> </a></div>
              <h2 class="depth title" ><a class="animated" href="/2017/05/17/js-pro-async/">async和defer的区别</a></h2>
            
            <time class="time title depth" datetime="2017-05-16T17:13:23.000Z">2017-05-17</time>
          </header>
      </div>
    </article>
  </div>

  <div class="archive titlelist">
    <article class="post">
      <div class="post-content animated fadeIn">
        <header>
            
              <div class="icon depth"><a href="/2017/05/16/css-disappear/"> </a></div>
              <h2 class="depth title" ><a class="animated" href="/2017/05/16/css-disappear/">CSS的几种消失机制</a></h2>
            
            <time class="time title depth" datetime="2017-05-15T16:33:28.000Z">2017-05-16</time>
          </header>
      </div>
    </article>
  </div>

  <div class="archive titlelist">
    <article class="post">
      <div class="post-content animated fadeIn">
        <header>
            
              <div class="icon depth"><a href="/2017/05/15/opencv-pdb/"> </a></div>
              <h2 class="depth title" ><a class="animated" href="/2017/05/15/opencv-pdb/">opencv+VS配置问题</a></h2>
            
            <time class="time title depth" datetime="2017-05-15T15:39:15.000Z">2017-05-15</time>
          </header>
      </div>
    </article>
  </div>

  <div class="archive titlelist">
    <article class="post">
      <div class="post-content animated fadeIn">
        <header>
            
              <div class="icon depth"><a href="/2017/05/09/js-dom-dynamicTag/"> </a></div>
              <h2 class="depth title" ><a class="animated" href="/2017/05/09/js-dom-dynamicTag/">document.write与innerHTML</a></h2>
            
            <time class="time title depth" datetime="2017-05-09T14:53:31.000Z">2017-05-09</time>
          </header>
      </div>
    </article>
  </div>




  <div class="animated fadeIn" idplus="CSS中的高度系列" style="display: none;">
    <div idplusp="CSS中的高度系列">
      <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img s1c="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-07-18T11:18:07.000Z"><a href="#">2017-07-18</a></time>
      
      
  
    <h1 class="depth title">CSS中的高度系列</h1>
  

    </header>
    <div class="entry depth">
      
        <table>
<thead>
<tr>
<th>各类高度</th>
<th>包含选项</th>
</tr>
</thead>
<tbody>
<tr>
<td>height</td>
<td>content</td>
</tr>
<tr>
<td>clientHeight</td>
<td>content+padding</td>
</tr>
<tr>
<td>offsetHeight</td>
<td>content+padding+border+scroll</td>
</tr>
<tr>
<td>scrollHeight</td>
<td><code>(子元素高度 &lt;= content)? clientHeight:(子元素高度 + padding)</code></td>
</tr>
</tbody>
</table>
<p>注意：当我们按照如下设置：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">div &#123;</div><div class="line">    height: 200px;</div><div class="line">    overflow-x: scroll; //始终显示滚动条</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>此时height的计算结果为183px，因为横向滚动条的高度为17px，需要减去这17px才是元素的实际高度值。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/CSS/">CSS</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



      
    </div>
  </div>



  <div class="animated fadeIn" idplus="Web应用初体验——登录登出验证系统" style="display: none;">
    <div idplusp="Web应用初体验——登录登出验证系统">
      <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img s1c="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-07-17T15:43:14.000Z"><a href="#">2017-07-17</a></time>
      
      
  
    <h1 class="depth title">Web应用初体验——登录登出验证系统</h1>
  

    </header>
    <div class="entry depth">
      
        <p>本系统所用技术包括：jade模板（加强的html），bootstrap（css样式集），express（Web应用框架），js，nodejs，mysql，token验证等。</p>
<p>GitHub地址：<a href="https://github.com/qingywen/DEMO/tree/master/Greeni" target="_blank" rel="external">https://github.com/qingywen/DEMO/tree/master/Greeni</a></p>
<p>基本功能如下：</p>
<ol>
<li>初次登录该系统首页可浏览公共页面并进行注册。</li>
<li>成为注册用户后可登录个人中心，关闭浏览器仍保持一天之内可随时登陆。</li>
<li>登录后可注销，此后则只能浏览公共页面。</li>
<li>登录一天后或者注销后，若访问个人中心则自动引导到登录页面。</li>
</ol>
<h2 id="step1"><a href="#step1" class="headerlink" title="step1"></a>step1</h2><p>先写前端界面，包括index.html(公共页面)，login.html(登录页面)，signup.html(注册页面)，my.html(个人中心)，这里用到了bootstrap的示例页面signin，carousel和dashboard的页面结构和样式。</p>
<p>也许会有人跟我一样刚开始接触bootstrap并不知从何用起，以下做个简短说明：bootstrap是一个css样式集，用的好可以为你的项目锦上添花，用不好反倒累赘，因此还需好好琢磨。了解bootstrap的菜鸟教程可以浏览<a href="http://www.runoob.com/bootstrap/bootstrap-tutorial.html" target="_blank" rel="external">菜鸟教程</a>。实际上，bootstrap3的<a href="http://v3.bootcss.com/" target="_blank" rel="external">中文官网</a>已经讲解的非常详尽。不过仍建议先阅读菜鸟教程进行热身。</p>
<p>页面js主要功能为表单提交，提交前先进行简单的验证，再序列化表单，接着用ajax提交到服务器，最后关闭表单的默认提交功能。</p>
<h2 id="step2"><a href="#step2" class="headerlink" title="step2"></a>step2</h2><p>前端界面搭建好后，我们来新建一个数据库，数据库表中只有一个users表，结构如下：</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Null</th>
<th>Key</th>
<th>Default</th>
<th>Extra</th>
</tr>
</thead>
<tbody>
<tr>
<td>P_Id</td>
<td>int(11)</td>
<td>No</td>
<td>PRI</td>
<td>NULL</td>
<td>auto_increment</td>
</tr>
<tr>
<td>email</td>
<td>varchar(255)</td>
<td>NO</td>
<td>UNI</td>
<td>NULL</td>
<td></td>
</tr>
<tr>
<td>password</td>
<td>varchar(255)</td>
<td>NO</td>
<td></td>
<td>NULL</td>
<td></td>
</tr>
</tbody>
</table>
<p>现在表数据如下：</p>
<table>
<thead>
<tr>
<th>P_Id</th>
<th>email</th>
<th>password</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1195259521@qq.com</td>
<td>123</td>
</tr>
<tr>
<td>9</td>
<td>qingywen@gmail.com</td>
<td>123</td>
</tr>
<tr>
<td>12</td>
<td>wenwu@gmai.com</td>
<td>123</td>
</tr>
<tr>
<td>14</td>
<td>123@qq.com</td>
<td>123</td>
</tr>
</tbody>
</table>
<p>数据库导出文件为greeni.sql，在本地数据库中将sql文件导入新建数据库greeni即可。</p>
<h2 id="step3"><a href="#step3" class="headerlink" title="step3"></a>step3</h2><p>前端、数据库搭建好后，我们即可开始整个应用的系统搭建，通过后台逻辑将前端和数据库连接起来。</p>
<p>这里在一个新文件夹中用<code>express</code>进行项目初始化，当然前提是本地用npm安装了express。接着在package.json中加入db、ejs、jsonwebtoken三个模块，然后用<code>cnpm install</code>进行安装。</p>
<p>这里我们需要将app.js文件中默认的渲染引擎从jade改为ejs。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// view engine setup</span></div><div class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</div><div class="line">pp.engine(<span class="string">'.html'</span>, <span class="built_in">require</span>(<span class="string">'ejs'</span>).__express);</div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'jade'</span>);</div></pre></td></tr></table></figure></p>
<p>修改routes文件夹下index.js、my.js的路由定向和事件句柄，此时要用到数据库，因此新建db文件夹，在db目录下新建DBConfig.js和SQL.js，分别用作数据库的连接配置文件和SQL语句模块。</p>
<p>在写登录验证的逻辑时，我们根据用户邮箱用jsonwebtoken随机生成一个令牌，并发送用户，用户在cookie中保存此令牌，在下次请求私有资源时则不必明文发送密码，而是在发送请求时随着cookie自动将令牌发送给服务器，服务器收到令牌验证成功后则返回用户所请求的资源，否则令牌有可能被恶意更改，则拒绝请求。</p>
<p>此时系统搭建完毕，我么可以用<code>npm start</code>来启动项目，注意bin文件夹写的端口号为8000，因此访问地址为：127.0.0.1:8000。</p>
<h2 id="step4"><a href="#step4" class="headerlink" title="step4"></a>step4</h2><p>最后我们想做一个小优化，如果每个用户登录到个人中心的页面都一样的话，这个个人中心恐怕是个假个人中心，因此我们需要对不同的用户请求返回一样的页面结构但是不同的用户信息。为求简易，这里我们只对每个用户返回各自的email，并添加到页面上。</p>
<p>因为页面首先需要在服务器上渲染才能返回给客户端，最经济的思路当然是在服务端渲染出不同的页面再返回给客户端。而html并没有变量的功能，因此我们使用jade模板（现更名为pug，但jade模块仍有效）来代替html。jade是一个非常高效的模板引擎，提供了变量、for循环等功能。有一个非常好的<a href="https://naltatis.github.io/jade-syntax-docs/" target="_blank" rel="external">jade语法学习网站</a>安利给大家。这里我们需要将之前的html转为jade，手动改编太麻烦，用这个<a href="http://www.html2jade.org/" target="_blank" rel="external">html2jade</a>的网站来转化吧。</p>
<p>得到jade格式的前端文件，我们修改app.js的模板引擎设置，将ejs引擎改回默认的jade引擎：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// view engine setup</span></div><div class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'jade'</span>);</div></pre></td></tr></table></figure></p>
<p>在routes下的my.js中，返回个人中心页面同时，返回用户的email：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">res.render(<span class="string">'my'</span>,&#123;<span class="attr">email</span>: decoded.email&#125;);</div></pre></td></tr></table></figure></p>
<p>修改views文件夹下my.jade文件中的标题，用来接收服务器传送来的email变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.navbar-brand(href=&apos;#&apos;) #&#123;email&#125;</div></pre></td></tr></table></figure></p>
<p>此后大功告成，每个用户登陆后访问个人中心的页面，其页面标题都是自己用来注册的email，因此此个人中心成立。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol>
<li>表单序列化方法<code>serialize()</code>，阻止表单默认提交方式<code>preventDefault()</code>，以及设置cookie的<code>CookieUtil.set()</code>均来自《JS高级程序设计》。</li>
<li>登录后通过令牌验证来避免密码泄露用到<code>jwt.sign() jwt.verify()</code>，建议细看jsonwebtoken包下的README.md，讲解很详细。</li>
<li>README.md文件是个好东西，许多网上的经验贴都没有官方使用文档讲的简单易懂。sublime有许多markdown实时阅览插件很方便，此<a href="http://www.jianshu.com/p/335b7d1be39e" target="_blank" rel="external">博主</a>有分享。</li>
<li>源代码是最后版本，因此前文所述中间过程可能不能详尽体现，但可以按照上述方式进行此系统的构建。这篇记录不是使用说明，仅作一个Guide，有问题Google和百度并行解决。若解决不了可联系数据库中P_Id为1的邮箱，我会尽快为你回复。</li>
</ol>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/express/">express</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



      
    </div>
  </div>



  <div class="animated fadeIn" idplus="浅谈令牌原理及漏洞分析" style="display: none;">
    <div idplusp="浅谈令牌原理及漏洞分析">
      <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img s1c="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-07-11T18:59:14.000Z"><a href="#">2017-07-12</a></time>
      
      
  
    <h1 class="depth title">浅谈令牌原理及漏洞分析</h1>
  

    </header>
    <div class="entry depth">
      
        <p>相关资源：<br><a href="https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/" target="_blank" rel="external">令牌讲解</a><br><a href="https://github.com/brianloveswords/node-jws" target="_blank" rel="external"> 使用方法</a></p>
<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><h3 id="token"><a href="#token" class="headerlink" title="token"></a>token</h3><p>中文译名为令牌，包含三个部分：header、payload、signature。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">token = encodeBase64(header) + <span class="string">'.'</span> + encodeBase64(payload) + <span class="string">'.'</span> + encodeBase64(signature)</div></pre></td></tr></table></figure>
<h3 id="header"><a href="#header" class="headerlink" title="header"></a>header</h3><p>此为令牌的头部，可以在其中设置签名算法和token类型，如下所示：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">header = <span class="string">'&#123;"alg":"HS256","typ":"JWT"&#125;'</span></div></pre></td></tr></table></figure></p>
<h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><p>该部分包含我们需要设置的信息：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">payload = <span class="string">'&#123;"loggedInAs":"admin","iat":1422779638&#125;'</span></div></pre></td></tr></table></figure></p>
<h3 id="signature"><a href="#signature" class="headerlink" title="signature"></a>signature</h3><p>signature则是将header和payload结合并用指定算法进行签名（加密）的结果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">key = <span class="string">'secretkey'</span></div><div class="line">unsignedToken = encodeBase64(header) + <span class="string">'.'</span> + encodeBase64(payload)</div><div class="line">signature = HMAC-SHA256(key, unsignedToken)</div></pre></td></tr></table></figure>
<h1 id="令牌原理"><a href="#令牌原理" class="headerlink" title="令牌原理"></a>令牌原理</h1><p>验证令牌有效性是整个机制的关键：我们的方法是根据header里提供的信息，对payload再次进行签名，并将结果与signature进行比对，如果一致，则令牌有效；若不一致，则说明是经过恶意改动的无效令牌。</p>
<h1 id="关键漏洞"><a href="#关键漏洞" class="headerlink" title="关键漏洞"></a>关键漏洞</h1><ol>
<li>因为我们的令牌中header和payload部分可直接通过解码获得，因此我们的签名算法等信息可以被任意人员获取，且signature部分的签名算法是通过header里的信息来决定的。因此攻击者可以将令牌头部信息设置为alt: none，因此服务器可能会将未经验证的signature当做已经验证过且有效的token。这样任何人就可以随意访问我们的系统。但是，现在大多数库都对此有一个防御机制：若提供了secret key，则那些设置为alt: none的令牌就无效，故而解决。</li>
<li>令牌机制的关键漏洞在于服务端的验证算法取决于令牌里的header信息。如果令牌采用RS256算法进行签名，一旦攻击者获得public key，则可以用如下方式来伪造令牌：将令牌的算法设置为HS256，并将secret key设置为RS256算法的签名公钥，这样就可以鱼目混珠啦。如下图所示。但这种方式理论上是这样，实际上的测试结果并不如此，而是返回invalid algorithm的错误。若有大神知道还求解答。不过针对此种错误，jsonwebtoken已经给出了相应的解决方案，服务端在验证时可以指定签名算法的类型，因此可以避免伪造令牌。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">var</span> jwt = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>);</div><div class="line"><span class="keyword">var</span> cert_pub = fs.readFileSync(__dirname + <span class="string">'/rsa-public-key.pem'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> tokenPayload = &#123;</div><div class="line">    <span class="attr">foo</span>: <span class="string">"bar"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> forgedToken = jwt.sign(tokenPayload,  cert_pub, &#123; <span class="attr">algorithm</span>: <span class="string">'HS256'</span> &#125;);</div><div class="line"></div><div class="line">jwt.verify(forgedToken, cert_pub, <span class="function"><span class="keyword">function</span>(<span class="params">err,decoded</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) &#123;</div><div class="line">        <span class="built_in">console</span>.error(err);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(decoded);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/NodeJS/">NodeJS</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



      
    </div>
  </div>



  <div class="animated fadeIn" idplus="mysql-setup" style="display: none;">
    <div idplusp="mysql-setup">
      <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img s1c="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-06-19T19:51:33.000Z"><a href="#">2017-06-20</a></time>
      
      
  
    <h1 class="depth title">mysql-setup</h1>
  

    </header>
    <div class="entry depth">
      
        <p>今天使用<code>mysql -uroot -p</code>在终端连接数据库时，一直报错<code>ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: YES) The current server installed: &quot;C:\Program Files\MySQL\MySQL Server 5.6\mysqld</code>，通过谷歌和百度搜寻了很多方法，大多都是关于如何重置root用户的密码，但由于版本不同，且答案冗杂，到最后也没能解决。因想起大一由于配置不好jdk的环境变量就放弃了Java，决定不能一头撞死，于是搜寻了下卸载MySQL的方法，准备重装。</p>
<h2 id="卸载MySQL"><a href="#卸载MySQL" class="headerlink" title="卸载MySQL"></a>卸载MySQL</h2><p>第一步：在<code>控制面板-程序和功能</code>中找到mysql进行卸载<br>第二步：找到安装目录，若仍有文件残余，则用360进行粉碎<br>第三步：清楚环境变量里mysql的配置<br>第四步：点击运行-regedit，打开注册编辑表，删除如下三个值：<br>    HKEY_LOCAL_ACHINE\SYSTEM\ControlSet001\Services\Eventlog\Application\MySQL<br>    HKEY_LOCAL_MACHINE\SYSTEM\ControlSet002\Services\Eventlog\Application\MySQL<br>    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Application\MySQL<br>至此，清理完毕</p>
<h2 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h2><p><a href="http://blog.csdn.net/zhuangm_888/article/details/50721583" title="[external] [title]" target="_blank" rel="external">MySQL5.7安装教程</a>中写的非常完整，每一步都十分必要，因此不再赘述。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/MySQL/">MySQL</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



      
    </div>
  </div>



  <div class="animated fadeIn" idplus="js-pro-event" style="display: none;">
    <div idplusp="js-pro-event">
      <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img s1c="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-06-05T16:48:29.000Z"><a href="#">2017-06-06</a></time>
      
      
  
    <h1 class="depth title">js-pro-event</h1>
  

    </header>
    <div class="entry depth">
      
        <h2 id="window-event"><a href="#window-event" class="headerlink" title="window.event"></a>window.event</h2><p>支持：IE，Opera，Chrome，Safari<br>返回：一个event对象，并被当前对象填充。<br>区别：IE中的window.event返回的event对象通常都含有固定的成员，其中只有一部分成员被当前对象填充；Opera，Chrome，Safari中，返回的event对象类型取决于当前事件。</p>
<h2 id="event"><a href="#event" class="headerlink" title="event"></a>event</h2><p>支持：IE9及以上，Opera，Chrome，Safari<br>发生：当一个事件产生，一个event对象则会被初始化并作为第一个参数传递给事件处理程序，event对象的类型取决于当前对象。且与window.event引用自同一个对象。<br>区别：IE9之前event对象当且仅当用attachEvent方法注册事件时才存在，并且是window.event的复制,但并不是同一对象。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/JavaScript/">JavaScript</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



      
    </div>
  </div>



  <div class="animated fadeIn" idplus="js-pro-ecma" style="display: none;">
    <div idplusp="js-pro-ecma">
      <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img s1c="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-05-17T09:44:30.000Z"><a href="#">2017-05-17</a></time>
      
      
  
    <h1 class="depth title">js-pro-ecma</h1>
  

    </header>
    <div class="entry depth">
      
        <ul>
<li>ECMAScript中的一切都区分大小写。</li>
<li>ECMAScript的变量是松散类型的，可以用来保存任何类型的数据。</li>
<li>ECMAScript的5种简单数据类型（基本数据类型）：Undefined、Null、Boolean、Number、String。还有一种复杂数据类型——Object。</li>
<li>操作符typeof null返回object，高程中解释说“null被认为是一个空对象的引用”，但规范里说明到对象值缺失的数据，其数据类型为null。</li>
<li>对未声明和未经初始化的变量执行typeof都会返回undefined。有一点要注意的是变量提升，即使变量已声明，解释器还是会先给变量赋值为undefined，直到上下文准备好，这个过程比较隐秘。</li>
<li>如果定义的变量将来用于保存对象，那么最好将该变量初始化为null。</li>
<li><code>var cat; console.log(cat == null);</code> 会返回true，是因为null == undefined。</li>
<li>不要测试浮点数值的大小！</li>
<li>数值转换的三种函数：Number()、parseInt()、parseFloat()。</li>
<li>转换为字符串：toString()方法，以及String()函数。</li>
<li>Object七大法宝：constructor、hasOwnProperty(propertyname)、isPrototypeOf(object)、propertyIsEnumerable(propertyName)、toLacaleString()、toString()、valueOf()</li>
<li>操作符包括：一元操作符、按位操作符、布尔操作符、乘性操作符、关系操作符、相等操作符、赋值操作符、逗号操作符</li>
<li>switch在比较的时候使用的是全等操作符。</li>
<li>ECMAScript中的函数定义的时候不必指定是否返回值；return语句可以不带有返回值；严格模式下不能出现两个参数同名的情况。</li>
<li>ECMAScript没有函数签名，相同的函数名称即使参数个数不同，后定义的会覆盖前面的，也就是没有重载。ECMAScript函数中的参数在内部是用一个数组来表示的，可以通过arguments对象来访问所传参数，且对所传参数个数没有要求，并不需要一定和命名参数个数相等。这一特性可以弥补没有重载的缺憾。</li>
<li>在通过函数的arguments对象修改参数值时，会反映到对应的命名参数中（内存空间相互独立，只是值会同步）。arguments对象的长度由传入参数个数决定，若修改长度之外的参数值，将不会反应到对应的命名参数中。而没有传递值的命名参数将自动被赋予undefined值。严格模式下不允许重写arguments值。</li>
<li>ECMAScript中所有的参数传递的都是值，不可能通过引用传递参数。</li>
<li>检测变量是什么基本数据类型：typeof操作符，返回值可能为undefined、string、boolean、number、object、function。检测变量是什么类型的对象：instanceof操作符,如果给定对象是引用类型的实例，则返回true。</li>
<li>JavaScript具有自动垃圾收集机制，垃圾收集器会按照固定的时间间隔周期性的执行这一项操作。</li>
<li>基本类型值在内存中占据固定空间的大小，因此被保存在栈内存中；引用类型的值是对象，保存在堆内存中。</li>
<li>标记清除是目前主流的垃圾回收机制。还有一种是引用计数，但当代码中存在循环引用时，引用计数方法会导致问题。</li>
<li>主动解除引用可以消除循环引用现象，对垃圾收集也有好处。因此需要及时解除不再使用的全局对象、全局对象属性以及循环变量的引用。</li>
<li>数组的length属性可读可写。</li>
<li>函数实际上是对象，每个函数都是Function类型的实例。由于函数是对象，函数名实际上是一个指向函数对象的指针，不会与某个函数绑定。</li>
<li>定义函数的三种方式：函数声明，函数表达式，构造函数方式（不推荐）。</li>
<li>函数声明和函数表达式的唯一区别：在代码开始执行前，解析器会进行函数声明提升将函数声明添加到源代码树的顶部。</li>
<li>要访问函数的指针而不是执行函数的话，必须去掉函数名后的括号。</li>
<li>函数有两个特殊的内部属性：arguments，包含传入函数的所有参数，且具有一个callee属性，指向拥有arguments对象的函数；另一个是this，引用的是函数据以执行的环境对象,也就是说谁调用了该函数，this就指向谁。</li>
<li>函数对象的另一个属性：caller,保存着调用当前函数的函数的引用。</li>
<li>引用类型与基本包装类型的主要区别就是对象的声明周期。基本包装类型包括：Number、String、Boolean。</li>
<li>布尔表达式中所有对象都会被转为true。</li>
<li>encodeURI只对空格编码，encodeURIComponent()会编码所有的非字母数字字符。</li>
<li>在所有代码执行之前，作用域中就已经存在两个内置对象：Global和Math。</li>
<li>对象的属性分为数据属性和访问器属性。数据属性有四种行为描述：configurable,enumerable,writable,value。访问器属性有四种行为描述：configurable,enumerable,get,set。都可以通过Object.defineProperty(object,propertyName,{})进行定义。读取则通过Obeject.getOwnPropertyDescriptor(object,propertyName)方法。</li>
</ul>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/JavaScript/">JavaScript</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



      
    </div>
  </div>



  <div class="animated fadeIn" idplus="async和defer的区别" style="display: none;">
    <div idplusp="async和defer的区别">
      <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img s1c="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-05-16T17:13:23.000Z"><a href="#">2017-05-17</a></time>
      
      
  
    <h1 class="depth title">async和defer的区别</h1>
  

    </header>
    <div class="entry depth">
      
        <p>当浏览器遇到script的时候，有三种情况：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script src=<span class="string">"test.js"</span>&gt;</div></pre></td></tr></table></figure>没有defer或async时，浏览器会立即加载和执行该脚本，并停止加载和渲染文档元素。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script src=<span class="string">"test.js"</span> <span class="keyword">async</span>=<span class="string">"async"</span>&gt;</div></pre></td></tr></table></figure>有async时，浏览器会异步加载和执行该脚本，但不影响文档元素的加载和渲染。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script src=<span class="string">"test.js"</span> defer=<span class="string">"defer"</span>&gt;</div></pre></td></tr></table></figure>有defer时，浏览器会异步加载该脚本，不影响文档元素的加载和渲染,但执行脚本的过程延迟到页面解析完毕后运行。<br>以上三个过程如下图。<br><img s1c="/2017/05/17/js-pro-async/defer_async.jpg" alt="图片来源(https://segmentfault.com/q/1010000000640869)" title="图片来源(https://segmentfault.com/q/1010000000640869)"><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;script src=<span class="string">"test1.js"</span> defer=<span class="string">"defer"</span>&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"test2.js"</span> <span class="attr">defer</span>=<span class="string">"defer"</span>&gt;</span><span class="undefined"></span></span></div></pre></td></tr></table></figure>此外，当同时有多个延迟脚本时，如上图，此时脚本1和脚本2会并行加载，但执行的顺序却有些复杂。HTML5规范延迟脚本按照它们出现的先后顺序执行,但实际中浏览器的实现机制却各不相同。当我在脚本1中写出一个执行时间远大于脚本2中的函数时，Chrome浏览器按照规范先执行脚本1，再执行脚本2;IE则会先执行脚本2，再执行脚本1；firefox同Chrome。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/JavaScript/">JavaScript</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



      
    </div>
  </div>



  <div class="animated fadeIn" idplus="CSS的几种消失机制" style="display: none;">
    <div idplusp="CSS的几种消失机制">
      <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img s1c="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-05-15T16:33:28.000Z"><a href="#">2017-05-16</a></time>
      
      
  
    <h1 class="depth title">CSS的几种消失机制</h1>
  

    </header>
    <div class="entry depth">
      
        <h2 id="display-none"><a href="#display-none" class="headerlink" title="display: none"></a>display: none</h2><p>元素消失，不占据页面空间。会导致页面的重排和重绘。无法获取鼠标事件。</p>
<h2 id="visibility-hidden"><a href="#visibility-hidden" class="headerlink" title="visibility: hidden"></a>visibility: hidden</h2><p>元素消失，占据页面空间。导致页面的重绘。无法获取鼠标事件。</p>
<h2 id="opacity-0"><a href="#opacity-0" class="headerlink" title="opacity: 0"></a>opacity: 0</h2><p>元素没有消失，只是看不见。导致页面的重绘。可获取鼠标事件。</p>
<h2 id="position-reletive-left-10000px"><a href="#position-reletive-left-10000px" class="headerlink" title="position: reletive; left: -10000px;"></a>position: reletive; left: -10000px;</h2><p>元素定位在可视区域之外。导致该元素的重排和重绘。无法获取鼠标事件。</p>
<h2 id="height-0-or-width-0"><a href="#height-0-or-width-0" class="headerlink" title="height:0 or width:0"></a>height:0 or width:0</h2><p>若设置<code>overflow:hidden</code>，元素无法获取鼠标事件。若没有，元素宽高仍为0，但其子元素会撑破父元素，因此仍可以通过子元素获取到鼠标事件。</p>
<h2 id="z-index：-1"><a href="#z-index：-1" class="headerlink" title="z-index：-1"></a>z-index：-1</h2><p>很少用到这个，不过有同学提到了，因此还是列出来。</p>
<p>此外，这元素都可以用选择器定位到，可见仍是可进行DOM操作的元素。因此虽然无法获取鼠标事件，但可以用js来触发事件响应。例如用<code>$(&#39;.item&#39;).click()</code>即触发点击事件。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/CSS/">CSS</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



      
    </div>
  </div>



  <div class="animated fadeIn" idplus="opencv+VS配置问题" style="display: none;">
    <div idplusp="opencv+VS配置问题">
      <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img s1c="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-05-15T15:39:15.000Z"><a href="#">2017-05-15</a></time>
      
      
  
    <h1 class="depth title">opencv+VS配置问题</h1>
  

    </header>
    <div class="entry depth">
      
        <p>安装了VS2012并下载了opencv249后，按照<a href="http://www.cnblogs.com/csulennon/p/3758234.html" target="_blank" rel="external">Lennon</a>的方法配置了系统环境变量、包含目录、库目录以及附加依赖，运行程序则开始出现各种错误，记录一下。</p>
<h3 id="找不到XXX-lib文件"><a href="#找不到XXX-lib文件" class="headerlink" title="找不到XXX.lib文件"></a>找不到XXX.lib文件</h3><p>确定附加依赖项配置文件路径及版本号正确。文件名后面的数字及版本号。</p>
<h3 id="无法找到xxx-dll文件"><a href="#无法找到xxx-dll文件" class="headerlink" title="无法找到xxx.dll文件"></a>无法找到xxx.dll文件</h3><p>缺乏动态文件库，可以手动下载并添加到<code>C:\Windows\System32</code>目录（或报错目录）下，下载地址为<a href="https://www.dll-files.com/" target="_blank" rel="external">Download missing dll</a></p>
<h3 id="无法打开或找不到PDB文件"><a href="#无法打开或找不到PDB文件" class="headerlink" title="无法打开或找不到PDB文件"></a>无法打开或找不到PDB文件</h3><p><img s1c="/2017/05/15/opencv-pdb/anwser1.PNG" alt="anwser1.PNG" title="">此图即可。</p>
<h3 id="“wb-exe”已退出，返回值为-1-0xffffffff"><a href="#“wb-exe”已退出，返回值为-1-0xffffffff" class="headerlink" title="“wb.exe”已退出，返回值为 -1 (0xffffffff)"></a>“wb.exe”已退出，返回值为 -1 (0xffffffff)</h3><p>查看main函数有一个输入文件路径填写不正确，因此程序退出一闪而过。将文件路径填写正确后才开始正常运行。具体情况具体分析。</p>
<h3 id="其他要注意的地方"><a href="#其他要注意的地方" class="headerlink" title="其他要注意的地方"></a>其他要注意的地方</h3><p>opencv中v10 代表适配 Visual Studio 2011<br>opencv中v11 代表适配 Visual Studio 2012<br>opencv中v14 代表适配 Visual Studio 2015<br>经验一：百度没有谷歌靠谱。<br>经验二：以后需要仔细查看报错信息而不是直接复制粘贴进行搜索。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/opencv/">opencv</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



      
    </div>
  </div>



  <div class="animated fadeIn" idplus="document.write与innerHTML" style="display: none;">
    <div idplusp="document.write与innerHTML">
      <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img s1c="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2017-05-09T14:53:31.000Z"><a href="#">2017-05-09</a></time>
      
      
  
    <h1 class="depth title">document.write与innerHTML</h1>
  

    </header>
    <div class="entry depth">
      
        <p>看到《DOM编程艺术》第7章，有几点值得记一下。</p>
<h3 id="document-write-与-innerHTML"><a href="#document-write-与-innerHTML" class="headerlink" title="document.write 与 innerHTML"></a>document.write 与 innerHTML</h3><p>document.write是一个古老的方法，它在W3C上定义了两种用途：一是在文档中输出HTML，另一种是在调用该方法的的窗口之外的窗口、框架中产生新文档（记得用close()关闭）。看似document.write对产生一个新的文档或窗口这样的用途很有意义，但书上说：<blockquote><p>document.write的最大缺点是它违背了“行为与样式分离的原则”。即使把document.write语句挪到外部函数里，也还是需要在标记的<code>&lt;body&gt;</code>部分使用<code>&lt;script&gt;</code>标签才能调用那个函数。</p>
</blockquote>厮以为作者在这里讲的并不清楚，document.write违背了行为与表现分离的原则并不在于函数需要放在外部引用还是内部引用，而是因为当我们写了一段document.write来产生一个HTML文档时，这个新文档的结构hin可能是这个样子的：<br><img s1c="/2017/05/09/js-dom-dynamicTag/document.PNG" alt="document.PNG" title="">如你所见，<code>&lt;script&gt;</code>标签在<code>&lt;p&gt;</code>标签前面，也就是说document.write只能在现有文档结构的最后添加元素，因此只要使用document.write,则必定有HTML标签在<code>&lt;script&gt;</code>标签之后。这样的标记顺序十分的混乱，且里面的<code>&lt;script&gt;</code>标签也不是我们想要的，这样让我对document.write的好感度一下降低零点。</p>
<p>反观用innerHTML来实现这个输出文档的功能，其输出文档结构如下：<br><img s1c="/2017/05/09/js-dom-dynamicTag/innerHTML.PNG" alt="innerHTML.PNG" title="">Look!这才是我们想要的行为与表现分离的文档结构！虽然innerHTML并不是DOM标准的组部分，但是已经包含在HTML5的规范中。几乎所有的浏览器都支持该属性，绝大多数情况下可以完美取代document.write方法。书上有一个很恰当的比方，“innerHTML就像一把大锤，而DOM则是一把手术刀”，我们可以用innerHTML大刀阔斧的直接插入网页内容，但是若想获取或修改DOM节点的属性等，我们还得需要DOM里更精确的方法如createElement与createTextNode等。</p>
<p>总结一下document.write与innerHTML的区别：</p>
<ul>
<li>write是document对象的一个方法，直接写入到页面的内容流，如果之前没有调用document.open，浏览器会自动调用document.open。每次写完关闭之后重新调用该函数会导致页面被重写。重写内容会被添加到<code>&lt;script&gt;</code>元素后，破坏结构和行为分离的原则。</li>
<li>innerHTML则是DOM页面元素的一个属性，代表该元素的html内容，可以精确到单个元素来进行修改，良好的而体现了结构和行为分离的原则。</li>
</ul>
<h3 id="重回图片库：结构样式分离升级版"><a href="#重回图片库：结构样式分离升级版" class="headerlink" title="重回图片库：结构样式分离升级版"></a>重回图片库：结构样式分离升级版</h3><p><blockquote><p>当有一段标记仅是为脚本服务的，即为了让DOM脚本处理它们，那么用DOM方法来创建它们才是最合适的选择</p>
</blockquote>行为与结构分离的三层逐级进化概念：</p>
<ol>
<li>给HTML文档引用外部脚本。</li>
<li>在HTML里设置挂钩，在外部js文件中给DOM节点添加事件，而不是在节点中添加类似<code>onclick=“func()”</code>这样的属性。</li>
<li>只是为了DOM操作而存在的DOM节点应该动态创建，而不是直接出现在标记里。</li>
</ol>
<h3 id="渐进增强与Ajax"><a href="#渐进增强与Ajax" class="headerlink" title="渐进增强与Ajax"></a>渐进增强与Ajax</h3><p>Ajax是一种用来与服务器异步交互的技术，其核心为XMLHttpRequest，很多书中都会大谈特谈Ajax的方便之处，但《DOM编程》显然为一股清澈之流，作者认为能通过Ajax实现的应用一定也可以通过非Ajax技术来实现，且构建Ajax网站最好的方法是先构建一个常规的网站，再去Hijax它。这个观点跟平稳退化有着相似之处。十分欣赏作者在网站构建方面的缜密思维，总会考虑到如果这个方法可用，则怎么去做，如果这个方法不可用，再怎么去做。从不假设用户的行为与环境，而是从最基本的条件出发，这样使得少量的特殊用户也能很好的浏览我们的站点。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/技术/">技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/DOM/">DOM</a>, <a href="/tags/JavaScript/">JavaScript</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



      
    </div>
  </div>





<div id="myCanvasContainer" class="animated fadeIn" style="display: none;">
 <canvas width="500" height="500" id="myCanvas">
 <ul>
  
    <li><h2><a href="/tags/CSS/">CSS</a></h2></li>
  
    <li><h2><a href="/tags/DOM/">DOM</a></h2></li>
  
    <li><h2><a href="/tags/Github/">Github</a></h2></li>
  
    <li><h2><a href="/tags/HTML/">HTML</a></h2></li>
  
    <li><h2><a href="/tags/HTTP/">HTTP</a></h2></li>
  
    <li><h2><a href="/tags/Hexo/">Hexo</a></h2></li>
  
    <li><h2><a href="/tags/JavaScript/">JavaScript</a></h2></li>
  
    <li><h2><a href="/tags/MySQL/">MySQL</a></h2></li>
  
    <li><h2><a href="/tags/NodeJS/">NodeJS</a></h2></li>
  
    <li><h2><a href="/tags/algorithm/">algorithm</a></h2></li>
  
    <li><h2><a href="/tags/express/">express</a></h2></li>
  
    <li><h2><a href="/tags/hexo/">hexo</a></h2></li>
  
    <li><h2><a href="/tags/interview/">interview</a></h2></li>
  
    <li><h2><a href="/tags/opencv/">opencv</a></h2></li>
  
    <li><h2><a href="/tags/sublime/">sublime</a></h2></li>
  
    <li><h2><a href="/tags/技术/">技术</a></h2></li>
  
  </ul>
 </canvas>
</div>
 


  <script>
  $(".archive").click(function (e) {
      if ($("title").text().indexOf( "青菜不是葵花" )>=0 ){
          if (e.target.href){
              $(".animated:contains(\'"+e.target.text+"\')").addClass("bounceOut");
              setTimeout(function(){
                  var pageTitle=e.target.text;
                  loadpage(pageTitle);
                  $(".animated:contains(\'"+e.target.text+"\')").removeClass("bounceOut");
                  history.pushState( pageTitle, $("title").text(), e.target.href);
              }, 500);
          }
      }
      return false;
  });
  </script>
  <script>
  $(".backtohome").click(function (e) {
      if ($("title").text() != "青菜不是葵花"){
          //go back to home
          setTimeout(function(){
              loadpage();
              history.pushState( null, $("title").text(), "/");
          }, 150);
      } else {
          //go to tag cloud
          loadpage("#tag");
          history.pushState( "#tag", $("title").text(), "#tag");
      }
      return false;
  });
  </script>

  <script>
  function loadpage(pageTitle) {
      scroll(0,0);
      if ( !pageTitle ){
          //home
          $('#myCanvasContainer').css("display","none");
          $("title").text("青菜不是葵花");
          $("[idplus]").css("display","none");
          $(".titlelist").css("display","");
      } else if ( pageTitle.indexOf("#tag")>=0 ) {
          //tagcloud
          $('#myCanvasContainer').css("display","");
          $("[idplus]").css("display","none");
          $(".titlelist").css("display","none");
          $("title").text("Tag Cloud | 青菜不是葵花");
      } else {
          //pages
          $('#myCanvasContainer').css("display","none");
          $("title").text(pageTitle + " | 青菜不是葵花");
          var pageIDplus=pageTitle.replace(/\s+/g,"")
          $(".titlelist").css("display","none");
          $("[idplus=\'" + pageIDplus +"\']" ).css("display","");
          $("[idplusp=\'" + pageIDplus +"\']" ).replaceWith($("[idplus=\'" + pageIDplus +"\']").html().replace(/img\ s1c/g, "img src"));
      }
  };
  </script>
  <script>
  window.addEventListener('popstate', function(e) {
      if (location.href.indexOf("#comment") > 0){
          location.reload();
      }else {
          loadpage(e.state);
      }
      },false);
  </script>
  <script>

  </script>




<nav id="pagination" class="titlelist">
  
    <a href="/" class="alignleft prev titlelist">Prev</a>
  
  
    <a href="/page/3/" class="alignright next titlelist">Next</a>
  
  <div class="clearfix"></div>
</nav>

</div></div>
    <div class="clearfix"></div>
  </div>

  <footer id="footer" class="inner"></footer>
  <script src="/js/headroom.min.and.gallery.js"></script>
<script>
$("#mini-toggle").click(function () {
    $( "#main-nav" ).css("display","inline");
    setTimeout(function(){
        $( "#main-nav" ).removeClass("slideInRight").addClass("slideOutRight");
    }, 3000);
    setTimeout(function(){
        $( "#main-nav" ).css("display","");
        $( "#main-nav" ).removeClass("slideOutRight").addClass("slideInRight");
    }, 3555);
});
</script>

<script>
$("#header").headroom({
  "tolerance": 0,
  "offset": 200,
  "classes": {
    "initial": "",
    "pinned": "slideInDown",
    "unpinned": "slideOutUp"
  }
});
$("#header").headroom("destroy");
console.log("这网站没彩蛋，不用找了……")
</script>

<script>
$("a").click(function () {
    $( "#icon-photo-small"  ).removeClass( "rotateIn" ).addClass( "rotateOut" );
    $( "#icon-photo-normal" ).removeClass( "rotateIn" ).addClass( "rotateOut" );
    setTimeout(function(){
        $( "#icon-photo-small"  ).removeClass( "rotateOut" ).addClass( "rotateIn" );
        $( "#icon-photo-normal" ).removeClass( "rotateOut" ).addClass( "rotateIn" );
    }, 900);
});
</script>


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-46393541-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<!--[if lt IE 9]><script src="/js/excanvas.js"></script><![endif]-->
<script src="/js/jquery.tagcanvas.min.js"></script>
 <script type="text/javascript">
 $(document).ready(function() {
   if( ! $('#myCanvas').tagcanvas({
     textColour : '#6d6d6d',
     outlineThickness : 1,
     textHeight: 20,
     maxSpeed : 0.04,
     depth : 0.75
   })) {
     // TagCanvas failed to load
     $('#myCanvasContainer').hide();
   }
   // your other jQuery stuff here...
 });
 </script>


<script src="/js/pangu.js"></script>
<script>pangu.page_spacing();</script>



<script src="/js/jquery.imagesloaded.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
</html>
